# Provider Workflows Release Integration
# Uses crossplane-contrib/provider-workflows for standardized releases
# Configured for rossigee GHCR registry

name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  # Use the standardized provider-workflows publish workflow
  publish:
    uses: crossplane-contrib/provider-workflows/.github/workflows/publish-provider.yml@main
    with:
      repository: provider-cloudflare
      version: ${{ github.ref_name }}
      go-version: '1.25.3'
      registry_org: rossigee
      mirror: false  # Disable mirroring to xpkg.upbound.io for rossigee registry
    secrets:
      GHCR_PAT: ${{ secrets.PAT_TOKEN }}

  # Create GitHub release with generated notes
  github-release:
    needs: publish
    runs-on: ubuntu-24.04
    permissions:
      contents: write
    steps:
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          name: Release ${{ github.ref_name }}
          draft: false
          prerelease: false
          generate_release_notes: true
